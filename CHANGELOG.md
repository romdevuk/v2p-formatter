# Changelog

All notable changes to the Video to Image Formatter (v2p-formatter) project will be documented in this file.

## [1.0.0] - 2025-11-23

### Added
- **Input/Output Folder Architecture**: Separated source files from generated output
  - Input folder: `/Users/rom/Documents/nvq/v2p-formatter-input` (read-only source MP4 files)
  - Output folder: `/Users/rom/Documents/nvq/v2p-formatter-output` (all generated files)
  - Each video gets its own subfolder in the output directory

- **File Selection System**: Replaced file upload with server-side file selector
  - Automatically scans input folder for MP4 files on page load
  - Displays files in a tree structure
  - Files are selected from the server, not uploaded

- **Time Point Selection**: Enhanced video time point selection
  - Video scrubbing/scrubbing to select time points
  - Preview thumbnails for each selected time point
  - Auto-generate time points: 5, 10, 15, 20, or custom number of evenly spaced shots
  - Visual thumbnail cards with remove functionality

- **DOCX Export**: Added Word document export capability
  - Generates DOCX files alongside PDF
  - Uses 2-column table layout with 1px black borders
  - Images maintain aspect ratio

- **Table Layout for Documents**: Implemented 2-column table layout
  - PDF: Uses ReportLab Table with 2 columns per row
  - DOCX: Uses python-docx Table with 2 columns per row
  - Single table for all rows (not separate tables per row)
  - 1px black borders on all cells
  - 5px spacing between bottom of image and table border

- **Dual Format Generation**: Generate both PDF and DOCX by default
  - Single button generates both formats simultaneously
  - Progress tracking for both files
  - Download links for both formats displayed

- **Dark Theme**: Complete dark theme implementation
  - Dark backgrounds for all sections, fields, and tables
  - Light text colors for readability
  - Dark buttons and form elements
  - Dark thumbnail preview cards
  - Consistent dark color scheme throughout

### Changed
- **Default Resolution**: Changed default image resolution from "original" to "640x480"
- **Output Structure**: All files now saved in video-specific subfolders
  - Structure: `OUTPUT_FOLDER/{video_filename}/`
  - PDF: `{video_filename}/{video_filename}.pdf`
  - DOCX: `{video_filename}/{video_filename}.docx`
  - Images: `{video_filename}/frames/1.jpg, 2.jpg, etc.`

- **UI Simplification**: 
  - Removed header section
  - Removed input/output folder information boxes
  - Merged "Image Configuration" and "PDF Configuration" into single "Output Settings" section
  - Simplified file loading (auto-loads on page load)

- **Button Labels**: 
  - Changed "Generate Document" to "Generate PDF & DOCX"
  - Updated to reflect dual format generation

### Fixed
- **Time Point Validation**: Fixed floating-point precision issues
  - Time points are now clamped to be within video duration
  - Prevents "outside video duration" errors
  - Handles edge cases at video end

- **PDF Image Scaling**: Fixed image scaling when "1 image per page" selected
  - Images now properly fill the page (95% of available space)
  - Maintains aspect ratio
  - No longer shows only 10% of image

- **File Loading**: Fixed "Loading MP4 files..." message persisting forever
  - Simplified file loading logic
  - Better error handling and user feedback

- **Thumbnail Display**: Fixed time point preview thumbnails
  - Now displays actual image previews instead of just text
  - Thumbnails load asynchronously
  - Visual cards with remove functionality

### Technical Details

#### Backend Changes
- **New Modules**:
  - `app/docx_generator.py`: DOCX document generation
  - Updated `app/pdf_generator.py`: Table-based layout
  - Updated `app/utils.py`: Subfolder management functions

- **New Endpoints**:
  - `/generate_docx`: Generate DOCX documents

- **Updated Endpoints**:
  - `/extract_frames`: Now handles array of time points directly
  - `/generate_pdf`: Returns consistent `file_path` field

#### Frontend Changes
- **Consolidated JavaScript**: Moved all core logic to inline script in `index.html`
- **Simplified File Loading**: Direct fetch calls, no complex retry logic
- **Enhanced Time Selection**: Direct onclick handlers, thumbnail previews
- **Dark Theme CSS**: Comprehensive dark theme styling

#### Dependencies
- Added `python-docx>=1.1.0` for DOCX generation

### Removed
- File upload functionality (replaced with file selector)
- Format selector dropdown (both formats generated by default)
- Input/Output folder information boxes from UI
- Header section from application interface

---

## Notes

- All generated files are saved in the output folder structure: `OUTPUT_FOLDER/{video_name}/`
- PDF and DOCX files use the video filename (without extension)
- Images are saved in a `frames/` subfolder within each video's output folder
- Default resolution is 640x480
- Both PDF and DOCX are generated automatically when clicking "Generate PDF & DOCX"

